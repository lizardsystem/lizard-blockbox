{% extends "lizard_map/wms.html" %}

{% block javascript-in-head %}
 {{ block.super }}
  <!--[if lte IE 8]><script language="javascript" type="text/javascript" src="{{ STATIC_URL }}lizard_blockbox/flot/excanvas.min.js"></script><![endif]-->
{% endblock %}


{% block javascript %}
   {{ block.super }}
    <script type="text/javascript"
        src="{{ STATIC_URL }}lizard_blockbox/flot/jquery.flot.js">
    </script>
    <script type="text/javascript"
        src="{{ STATIC_URL }}lizard_blockbox/flot/jquery.flot.symbol.js">
    </script>
    <script type="text/javascript"
        src="{{ STATIC_URL }}lizard_blockbox/underscore.js">
    </script>
    <script type="text/javascript"
        src="{{ STATIC_URL }}lizard_blockbox/backbone.js">
    </script>
    <script type="text/javascript"
        src="{{ STATIC_URL }}lizard_blockbox/data.js">
    </script>
    <script type="text/coffeescript"
        src="{{ STATIC_URL }}lizard_blockbox/blokkendoos.coffee">
    </script>
{% endblock %}

{% block map-javascript %}
  {{ block.super }}
  <!--
    <script type="text/javascript"
        src="{{ STATIC_URL }}lizard_blockbox/graph_with_flot.js">
    </script>
  -->

   <script type="text/javascript">
	 var selectControl, selectedFeature;

	 function JSONLayer(name, json){
	     var geojson_format = new OpenLayers.Format.GeoJSON();
         var vector_layer = new OpenLayers.Layer.Vector(name);
         map.addLayer(vector_layer);
	     vector_layer.addFeatures(geojson_format.read(json));
	 }

    function onPopupClose(evt) {
        selectControl.unselect(selectedFeature);
    }

    function onFeatureHighlight(feature){
        selectedFeature = feature;
        ff = feature.feature
        popup = new OpenLayers.Popup.FramedCloud("chicken",
            ff.geometry.getBounds().getCenterLonLat(),
            null,
            "<div style='font-size:.8em'>" + ff.data.titel + "</div>",
            null, false, false);
        feature.feature.popup = popup;
        map.addPopup(popup);
    }


    function onFeatureUnhighlight(feature) {
        map.removePopup(feature.feature.popup);
        feature.feature.popup.destroy();
        feature.feature.popup = null;
    }



    function JSONTooltip(name, json) {
        var geojson_format = new OpenLayers.Format.GeoJSON();
        var vector_layer = new OpenLayers.Layer.Vector(name);
        map.addLayer(vector_layer);
        vector_layer.addFeatures(geojson_format.read(json));

        var highlightCtrl = new OpenLayers.Control.SelectFeature(vector_layer, {
            hover: true,
            highlightOnly: true,
            renderIntent: "temporary",
            eventListeners: {
                featurehighlighted: onFeatureHighlight,
                featureunhighlighted: onFeatureUnhighlight
            }
        });
        map.addControl(highlightCtrl);
        highlightCtrl.activate();
    }

	 $().ready(function() {
         $.getJSON("{{ STATIC_URL }}lizard_blockbox/QS.json",
             function(json){
                 JSONTooltip('QS', json);
             }
         );

         $.getJSON("{{ STATIC_URL }}lizard_blockbox/IVM_deel1.json",
             function(json){
                 JSONTooltip('IVM deel 1', json);
             }
         );
         $.getJSON("{{ STATIC_URL }}lizard_blockbox/rijntakken.json",
             function(json){
                 JSONLayer('Rijntak', json);
             }
         );
	     $.getJSON("/blokkendoos/api/rivers/maas/",
             function(json){
                 JSONLayer('Maas', json);
             }
         );

     });
   </script>

   <script type="text/template" id="measure-template">
        <strong>Measure</strong>
   </script>
{% endblock %}

{% block css %}
  {{ block.super }}
  <link rel="stylesheet"
        href="{{ STATIC_URL }}lizard_blockbox/lizard_blockbox.less"
        type="text/less"
        media="screen, projection" />
{% endblock css %}

{% block sidebar %}
<h3>Maatregelen</h3>
<ul id="measures-list" class="without-bullets" />
{% endblock %}

{% block content %}
  <div id="blockbox">
    <div id="lizard-blockbox-graph">
      {% block lizard-blockbox-graph %}
      <div id="placeholder_top_legend"
           style="width:100%;height:0px;"></div>
      <div id="placeholder_top"
           style="width:100%;height:150px;"></div>
      <!-- placeholder_top is the actual graph. -->
      <div id="placeholder_control"
           style="width:100%;height:100px;"></div>
      <!-- placeholder_control is the graph part with the measures. -->
      <div id="placeholder_control_legend"
           style="width:100%;height:0px;"></div>
      <!-- Note: this placeholder_control_legend isn't shown right now. -->
      {% endblock %}
    </div>
    <div id="blockbox-table">
      TODO: table here.
    </div>

    {{ block.super }}
  </div>
{% endblock %}
